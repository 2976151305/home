<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <link rel="stylesheet" href="../layui/css/layui.css">
  <link rel="stylesheet" href="../css/owl.carousel.min.css">
  <link rel="stylesheet" href="../css/style.css">
  <link rel="stylesheet" href="../layui/css/layui.mobile.css">
  <script src="../js/jquery-1.11.3.min.js"></script>
  <!--[if lt IE 9]>
    <script src="https://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
    <script src="https://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
  <![endif]-->
  <script src="../js/mian.js"></script>
  <title>整装之家</title>
</head>

<body>
  <header id="header"></header>
  <div id="carousel" class="layui-carousel">
    <ul carousel-item>
    </ul>
  </div>

  <main>
    <div class="layui-container block-pt case">
      <div class="textC">
        <h1 class="block-title layui-inline">装修案例</h1>
      </div>
      <div class="layui-col-space20">
        <div class="layui-col-lg8">
          <div id="case_carousel" class="layui-carousel" lay-filter="case_carousel">
            <ul carousel-item></ul>
          </div>
        </div>
        <div class="layui-col-lg4">
          <div class="case-info textC">
            <h2></h2>
            <p class="textJ"></p>
          </div>
        </div>
      </div>
      <div class="layui-clear"></div>
    </div>
    <div class="block-pt">
      <div class="textC">
        <h1 class="block-title layui-inline">智能家居</h1>
      </div>
      <img class="cover-img" style="height: 600px;">
    </div>
    <div class="layui-container block-pt">
      <div class="textC">
        <h1 class="block-title layui-inline">装修流程</h1>
      </div>
    </div>
    <div class="layui-container block-pt">
      <div class="textC">
        <h1 class="block-title layui-inline">装修现场</h1>
      </div>
      <div class="layui-border-box">
        <div class="mhn-slide owl-carousel">
          <!-- <div class="mhn-item">
            <div class="mhn-inner">
              <img src="https://source.unsplash.com/600x400/?paper">
              <div class="mhn-img"></div>
            </div>
          </div> -->
        </div>
      </div>
    </div>
    <div class="block-pt advantage">
      <div class="textC">
        <h1 class="block-title layui-inline">我们的优势</h1>
      </div>
      <div class="advantage-box">
        <div class="layui-container">
          <div class="advantage-item layui-col-lg6">
            <div class="b"></div>
            <div class="img-box">
              <img class="cover-img" style="height: 100%;">
            </div>
            <div class="layui-inline go-detail textC">查看详情</div>
          </div>
          <div class="advantage-item layui-col-lg6">
            <div class="b"></div>
            <div class="img-box">
              <img class="cover-img" style="height: 100%;">
            </div>
            <div class="layui-inline go-detail textC">查看详情</div>
          </div>
        </div>
      </div>
      <div class="layui-clear"></div>
    </div>
    <div class="layui-container block-pt home-article">
      <div class="textC">
        <h1 class="block-title layui-inline">装修知多少</h1>
      </div>
      <div class="layui-col-space10 home-article-list">
      </div>
      <div class="layui-clear"></div>
    </div>
    <div class="layui-container block-pt">
      <div class="textC">
        <h1 class="block-title layui-inline">装修效果图</h1>
      </div>
    </div>
  </main>
  <!-- 底部浮动条 -->
  <div class="bottom-bar">
    <div class="layui-container">
      <h1 class="f-l">免费获取装修设计方案</h1>
      <div class="f-r layui-form">
        <div class="layui-input-inline mr30" data-toggle="distpicker">
          <select name="province" id="province" lay-verify="required" class="layui-input"></select>
          <select name="city" id="city" lay-verify="required" class="layui-input"></select>
        </div>
        <div class="layui-input-inline mr30">
          <input type="text" class="layui-input" name="phone" id="phone" maxlength="11" placeholder="填写手机号码"
            autocomplete="off">
        </div>
        <div class="layui-input-inline mr30">
          <input type="text" class="layui-input" name="area" id="area" placeholder="输入您的装修面积" autocomplete="off">
        </div>
        <div class="layui-input-inline">
          <button class="layui-btn layui-btn-primary apply">立即免费获取</button>
        </div>
      </div>
      <div class="layui-clear"></div>
    </div>
  </div>

  <footer id="footer"></footer>

  <script src="../js/distpicker.data.min.js"></script>
  <script src="../js/distpicker.min.js"></script>
  <script src="../layui/layui.js"></script>
  <script src="../js/owl.carousel.min.js"></script>
  <script>
    var caseCarousel = []
    var $carousel = $('#carousel ul')
    var $caseCarousel = $('#case_carousel ul')
    var $articleList = $('.home-article-list')
    var $caseInfo = $('.case-info')
    var $bottomBar = $('.bottom-bar')
    jQuery(function () {
      $("#distpicker").distpicker();
      if (localStorage.getItem('c')) {
        $bottomBar.append(
          '<a href="javascript:;" class="close-bottom-bar"><i class="layui-icon layui-icon-close"></i></a>')
        $('.close-bottom-bar').on('click', function () {
          $bottomBar.remove()
        })
      }
      active.query('/decorate/advertising/api/adverts/decorate/scene/').then(res => {
        console.log(res)
        let arr = []
        res.data.forEach(item => {
          arr.push(`
          <div class="mhn-item">
            <div class="mhn-inner">
              <div class="mhn-img" style="background: url(${item.image}) no-repeat center / cover;"></div>
            </div>
          </div>`.trim())
        })
        $('.mhn-slide').append(arr)
        $('.mhn-slide').owlCarousel({
          nav: true,
          //loop:true,
          slideBy: 'page',
          rewind: false,
          responsive: {
            350: {
              items: 1
            },
            768: {
              items: 2
            },
            992: {
              items: 3
            },
            1220: {
              items: 4
            }
          },
          smartSpeed: 500,
          navText: [
            '<svg viewBox="0 0 24 24"><path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"></path></svg>',
            '<svg viewBox="0 0 24 24"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"></path></svg>'
          ]
        });
      })
    })
    layui.use(['element', 'carousel', 'layer'], function () {
      var element = layui.element
      var carousel = layui.carousel
      var layer = layui.layer
      active.query('/decorate/advertising/api/adverts/').then(res => {
        if (res.code === 'success') {
          let arr = []
          res.data.forEach(item => {
            if (item.ad_location === '首页banner') {
              arr.push(`
              <li>
                <a class="w h block" style="background: url(${item.image}) no-repeat center / cover;" href="${item.link_url ? item.link_url : 'javascript:;'}"></a>
              </li>
              `.trim())
            }
          })
          $carousel.append(arr)
          // big banner
          carousel.render({
            elem: '#carousel',
            width: '100%',
            height: '670px',
            anim: 'fade',
            interval: '5000',
          })
        }
      }).catch(err => new Error(err))
      // 案例轮播
      active.query('/decorate/cases/api/case/recommend/').then(res => {
        if (res.code === 'success') {
          let arr = []
          res.data.cases.forEach(item => {
            caseCarousel.push(item)
            arr.push(
              `<li>
                  <a class="w h block" href="./case.html?id=${item.id}" style="background: url(${item.cover_img}) no-repeat center / cover;"></a>
                </li>`)
          })
          $caseCarousel.append(arr)
          $caseInfo.children('h2').text(caseCarousel[0].title)
          $caseInfo.children('p').text(caseCarousel[0].features_describe)
          // case banner
          carousel.render({
            elem: '#case_carousel',
            autoplay: false,
            width: '100%',
            height: '400px',
            arrow: 'always',
            indicator: 'none'
          })
        }
      }).catch(err => new Error(err))

      active.query('/decorate/articles/api/articles/').then(res => {
        if (res.code === 'success') {
          let i = 0
          let arr = []
          res.data.forEach(item => {
            if (i < 5) {
              if (item.if_join_recommend) {
                arr.push(`
                <article class="article-item">
                  <article>
                    <div class="article-cover-img" style="background: url(${item.cover_img}) no-repeat center / cover"></div>
                    <h2 class="layui-elip">${item.title}</h2>
                  </article>
                </div>
              `.trim())
                i++
              }
            }
          })
          $articleList.append(arr)
        }
      }).catch(err => {
        new Error(err)
      })
      // 滑动切换监听事件
      carousel.on('change(case_carousel)', function (e) {
        $caseInfo.children('h2').text(caseCarousel[e.index].title)
        $caseInfo.children('p').text(caseCarousel[e.index].features_describe)
      })
      let $apply = $('.apply')
      // 申请
      $apply.on('click', function () {
        let $phone = $('#phone').val()
        let $area = $('#area').val()
        let $province = $('#province').val()
        let $city = $('#city').val()
        if (!$area.length || !$phone.length) {
          layer.msg('填写装修面积和手机号码之后才能免费预约哦！')
          return false
        }
        let data = {
          phone: $phone,
          area: $area,
          city: $province + $city
        }
        active.query('/decorate/cases/api/case/apply/', data, 'POST').then(res => {
          console.log(res)
          if (res.code === 'success') {
            layer.open({
              title: '预约成功',
              icon: 1,
              content: '稍后会有装修管家以xxxx或xxxx开头的号码回电您，向您免费提供装修咨询服务。',
              btn: '知道了',
              shade: .5,
              shadeClose: false
            })
            if (!localStorage.getItem('c')) {
              localStorage.setItem('c', true)
              $bottomBar.append(
                '<a href="javascript:;" class="close-bottom-bar"><i class="layui-icon layui-icon-close"></i></a>'
              )
              $('.close-bottom-bar').on('click', function () {
                $bottomBar.remove()
              })
            }
          } else {
            layer.msg(res.data.msg)
          }
        }).catch(err => {
          layer.msg('提交失败,请稍后重试!')
          new Error(err)
        })
      })
    })
  </script>
</body>

</html>